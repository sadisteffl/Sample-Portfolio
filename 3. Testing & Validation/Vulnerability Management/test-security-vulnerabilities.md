# Test Security Vulnerabilities

This file contains intentional security vulnerabilities for testing the security scanning workflows.

## ðŸš¨ FOR TESTING PURPOSES ONLY

## 1. SQL Injection Vulnerability (Python)

```python
import sqlite3

def vulnerable_sql_query(user_input):
    conn = sqlite3.connect('test.db')
    cursor = conn.cursor()

    # VULNERABLE: Direct string concatenation leads to SQL injection
    query = "SELECT * FROM users WHERE username = '" + user_input + "'"
    cursor.execute(query)

    return cursor.fetchall()

# Another SQL injection example
def login(username, password):
    conn = sqlite3.connect('test.db')
    cursor = conn.cursor()

    # VULNERABLE: String formatting in SQL
    query = "SELECT * FROM users WHERE username = '%s' AND password = '%s'" % (username, password)
    cursor.execute(query)

    return cursor.fetchone()
```

## 2. Hardcoded Credentials (Multiple Types)

```python
# AWS Keys
AWS_ACCESS_KEY = "AKIAIOSFODNN7EXAMPLE"
AWS_SECRET_KEY = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"

# Database Credentials
DATABASE_URL = "postgresql://admin:secretpassword123@localhost:5432/prod_db"
API_KEY = "sk-1234567890abcdef1234567890abcdef12345678"

# JWT Secret
JWT_SECRET = "my-super-secret-jwt-key-that-should-not-be-in-code"

# Private Key (RSA)
PRIVATE_KEY = """-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAzKlV3QgVgFzFzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
JzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
JzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
JzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
JzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
JzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJzJz
QIDAQABAoIBAQC...
-----END RSA PRIVATE KEY-----"""
```

## 3. Command Injection Vulnerability

```python
import subprocess
import os

def vulnerable_ping(host):
    # VULNERABLE: Direct command execution with user input
    command = "ping -c 4 " + host
    return os.system(command)

def vulnerable_file_read(filename):
    # VULNERABLE: Command injection via subprocess
    command = "cat " + filename
    result = subprocess.run(command, shell=True, capture_output=True, text=True)
    return result.stdout

def vulnerable_system_call(user_input):
    # VULNERABLE: System call with user input
    os.system("echo " + user_input)
```

## 4. Cross-Site Scripting (XSS) Vulnerability

```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route('/comment')
def comment():
    user_comment = request.args.get('comment', '')

    # VULNERABLE: Direct rendering of user input without escaping
    template = f"""
    <html>
    <body>
        <h1>User Comment:</h1>
        <div>{user_comment}</div>
    </body>
    </html>
    """
    return template

@app.route('/search')
def search():
    query = request.args.get('q', '')

    # VULNERABLE: XSS in search results
    return f"<h1>Search Results for: {query}</h1>"
```

## 5. Path Traversal Vulnerability

```python
import os

def read_file(filename):
    # VULNERABLE: Path traversal allows access to arbitrary files
    filepath = '/var/www/files/' + filename

    try:
        with open(filepath, 'r') as f:
            return f.read()
    except FileNotFoundError:
        return "File not found"

def vulnerable_config_read(config_name):
    # VULNERABLE: Directory traversal via config name
    config_path = '../configs/' + config_name + '.conf'
    return open(config_path, 'r').read()
```

## 6. Weak Cryptography

```python
import hashlib
import base64
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes

def weak_hashing(password):
    # VULNERABLE: MD5 is cryptographically weak
    return hashlib.md5(password.encode()).hexdigest()

def weak_encryption(data, key):
    # VULNERABLE: DES is weak and has small key size
    cipher = Cipher(algorithms.TripleDES(key), modes.ECB())
    # Note: TripleDES is still considered weak for modern applications

def hardcoded_iv_encryption(data):
    # VULNERABLE: Hardcoded IV/nonce
    key = b'sixteen byte key'
    iv = b'hardcoded_iv123'  # Should be random and unique per encryption
    cipher = Cipher(algorithms.AES(key), modes.CBC(iv))
```

## 7. Insecure Random Number Generation

```python
import random

def generate_token():
    # VULNERABLE: Using random for security-sensitive tokens
    return str(random.random())

def generate_session_id():
    # VULNERABLE: Predictable session IDs
    return random.randint(100000, 999999)

def weak_password_reset():
    # VULNERABLE: Weak random number for password reset
    return str(random.random())[:8]
```

## 8. Docker Compose with Vulnerabilities

```yaml
version: '3.8'
services:
  web:
    image: nginx:1.14  # OLD version with known vulnerabilities
    ports:
      - "80:80"
    environment:
      - DEBUG=true  # Debug mode in production
      - API_KEY=sk-1234567890abcdef1234567890abcdef12345678  # Hardcoded secret

  database:
    image: postgres:9.6  # OLD version with known vulnerabilities
    environment:
      - POSTGRES_PASSWORD=admin123  # Weak hardcoded password
      - POSTGRES_USER=admin
      - POSTGRES_DB=production
    ports:
      - "5432:5432"  # Exposed database port

  redis:
    image: redis:4.0  # OLD version
    command: redis-server --requirepass secretpassword  # Hardcoded password
    ports:
      - "6379:6379"  # Exposed Redis port
```

## 9. Terraform with Security Issues

```hcl
# Terraform configuration with security issues

resource "aws_security_group" "web_sg" {
  name        = "web-security-group"
  description = "Allow all traffic"

  # VULNERABLE: Open to all traffic
  ingress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

resource "aws_instance" "web_server" {
  ami           = "ami-12345678"
  instance_type = "t2.micro"

  # VULNERABLE: Hardcoded credentials in user data
  user_data = <<-EOF
              #!/bin/bash
              echo "export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE" >> /etc/environment
              echo "export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY" >> /etc/environment
              EOF

  # VULNERABLE: No IAM role, uses instance profile with full access
  iam_instance_profile = "full-admin-access"
}

resource "aws_s3_bucket" "sensitive_data" {
  bucket = "sensitive-data-bucket-${random_id.bucket_suffix.hex}"

  # VULNERABLE: Public read access
  acl = "public-read"

  # VULNERABLE: No versioning
  versioning {
    enabled = false
  }

  # VULNERABLE: No encryption
  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm = "AES256"
      }
    }
  }
}
```

## 10. Kubernetes with Security Issues

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: vulnerable-pod
spec:
  containers:
  - name: web-container
    image: nginx:1.14  # OLD version with vulnerabilities
    ports:
    - containerPort: 80
    # VULNERABLE: Running as root
    securityContext:
      runAsUser: 0
      privileged: true
    # VULNERABLE: Sensitive data in environment variables
    env:
    - name: DATABASE_PASSWORD
      value: "secretpassword123"
    - name: API_KEY
      valueFrom:
        secretKeyRef:
          name: api-secret
          key: key
    # VULNERABLE: Mounting host filesystem
    volumeMounts:
    - name: host-root
      mountPath: /host
  volumes:
  - name: host-root
    hostPath:
      path: /
      type: Directory
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-service-account
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-cluster-binding
subjects:
- kind: ServiceAccount
  name: admin-service-account
  namespace: default
roleRef:
  kind: ClusterRole
  name: cluster-admin  # VULNERABLE: Full cluster admin access
  apiGroup: rbac.authorization.k8s.io
```

## Expected Security Tool Detection

### Semgrep Should Detect:
- SQL injection patterns
- Hardcoded credentials (basic detection)
- Command injection
- XSS vulnerabilities
- Path traversal
- Weak cryptography usage
- Insecure random number generation

### TruffleHog Should Detect:
- AWS access keys
- Database passwords
- API keys
- JWT secrets
- Private keys
- All hardcoded credentials

### Trivy Should Detect:
- Vulnerable Docker image versions (nginx:1.14, postgres:9.6, redis:4.0)
- Terraform security misconfigurations
- Kubernetes security issues
- License compliance issues

---

**NOTE**: This file is intentionally vulnerable for security testing purposes only!
**NEVER** commit secrets or vulnerable code to production repositories.